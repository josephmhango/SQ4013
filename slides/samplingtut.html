<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr K.J. Mhango">

<title>Spatial Sampling in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="samplingtut_files/libs/clipboard/clipboard.min.js"></script>
<script src="samplingtut_files/libs/quarto-html/quarto.js"></script>
<script src="samplingtut_files/libs/quarto-html/popper.min.js"></script>
<script src="samplingtut_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="samplingtut_files/libs/quarto-html/anchor.min.js"></script>
<link href="samplingtut_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="samplingtut_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="samplingtut_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="samplingtut_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="samplingtut_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#aim-of-this-tutorial" id="toc-aim-of-this-tutorial" class="nav-link active" data-scroll-target="#aim-of-this-tutorial">1. Aim of this tutorial</a></li>
  <li><a href="#study-area-loading-the-monolithic-geojson-polygon" id="toc-study-area-loading-the-monolithic-geojson-polygon" class="nav-link" data-scroll-target="#study-area-loading-the-monolithic-geojson-polygon">2. Study area: loading the monolithic GeoJSON polygon</a></li>
  <li><a href="#creating-a-regular-grid-over-the-polygon" id="toc-creating-a-regular-grid-over-the-polygon" class="nav-link" data-scroll-target="#creating-a-regular-grid-over-the-polygon">3. Creating a regular grid over the polygon</a>
  <ul class="collapse">
  <li><a href="#creating-centroids" id="toc-creating-centroids" class="nav-link" data-scroll-target="#creating-centroids">3.1 Creating centroids</a></li>
  </ul></li>
  <li><a href="#simple-random-sampling" id="toc-simple-random-sampling" class="nav-link" data-scroll-target="#simple-random-sampling">4. Simple random sampling</a>
  <ul class="collapse">
  <li><a href="#simple-random-sampling-srs" id="toc-simple-random-sampling-srs" class="nav-link" data-scroll-target="#simple-random-sampling-srs">4. Simple Random Sampling (SRS)</a>
  <ul class="collapse">
  <li><a href="#key-features-of-srs" id="toc-key-features-of-srs" class="nav-link" data-scroll-target="#key-features-of-srs">Key features of SRS:</a></li>
  <li><a href="#how-its-used" id="toc-how-its-used" class="nav-link" data-scroll-target="#how-its-used">How it’s used:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#stratified-sampling" id="toc-stratified-sampling" class="nav-link" data-scroll-target="#stratified-sampling">5. Stratified sampling</a>
  <ul class="collapse">
  <li><a href="#what-is-stratified-sampling" id="toc-what-is-stratified-sampling" class="nav-link" data-scroll-target="#what-is-stratified-sampling">What is stratified sampling?</a></li>
  <li><a href="#how-is-stratified-sampling-implemented-here" id="toc-how-is-stratified-sampling-implemented-here" class="nav-link" data-scroll-target="#how-is-stratified-sampling-implemented-here">How is stratified sampling implemented here?</a></li>
  <li><a href="#creating-strata" id="toc-creating-strata" class="nav-link" data-scroll-target="#creating-strata">5.1 Creating strata</a></li>
  <li><a href="#proportional-stratified-sampling" id="toc-proportional-stratified-sampling" class="nav-link" data-scroll-target="#proportional-stratified-sampling">5.2 Proportional stratified sampling</a></li>
  </ul></li>
  <li><a href="#cluster-sampling" id="toc-cluster-sampling" class="nav-link" data-scroll-target="#cluster-sampling">6. Cluster sampling</a>
  <ul class="collapse">
  <li><a href="#creating-clusters" id="toc-creating-clusters" class="nav-link" data-scroll-target="#creating-clusters">6.1 Creating clusters</a></li>
  <li><a href="#sampling-clusters" id="toc-sampling-clusters" class="nav-link" data-scroll-target="#sampling-clusters">6.2 Sampling clusters</a></li>
  </ul></li>
  <li><a href="#generating-random-points-within-sampled-cells" id="toc-generating-random-points-within-sampled-cells" class="nav-link" data-scroll-target="#generating-random-points-within-sampled-cells">7. Generating random points within sampled cells</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">8. Exercises</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spatial Sampling in R</h1>
<p class="subtitle lead">Simple Random, Stratified, and Cluster Designs</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr K.J. Mhango </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Core packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="aim-of-this-tutorial" class="level1">
<h1>1. Aim of this tutorial</h1>
<p>In this 2-hour, hands-on tutorial you will learn how to:</p>
<ul>
<li><p>Start from a <strong>single (monolithic) polygon</strong> representing your study area (e.g.&nbsp;a field, farm, or region) in GeoJSON format.</p></li>
<li><p>Create a <strong>regular grid</strong> over this polygon using <code>sf</code>.</p></li>
<li><p>Use the grid as a <strong>sampling frame</strong>.</p></li>
<li><p>Implement <strong>simple random sampling</strong>, <strong>stratified sampling</strong>, and <strong>cluster sampling</strong>.</p></li>
<li><p>Visualise the results.</p></li>
</ul>
</section>
<section id="study-area-loading-the-monolithic-geojson-polygon" class="level1">
<h1>2. Study area: loading the monolithic GeoJSON polygon</h1>
<p>We assume you have a file named <strong>starter.geojson</strong>. To load our study area polygon, we use the <a href="https://r-spatial.github.io/sf/"><code>sf</code></a> package, which is the standard for handling spatial vector data in R. The function <code>st_read()</code> is used to read the GeoJSON file (<code>starter.geojson</code>) into R as an <code>sf</code> object. This allows us to work with the polygon using other spatial functions and operations.</p>
<p>We then use <code>st_transform()</code> to reproject the polygon to a projected coordinate reference system (CRS), specifically <strong>EPSG:3857</strong> (Web Mercator). This is important because many spatial operations (such as creating grids or measuring area/distance) require coordinates in metres (projected), not degrees (geographic coordinates like WGS84/EPSG:4326). Projected CRS ensures accurate units for spatial sampling and visualisation.</p>
<p>The object is then plotted using the <code>ggplot2</code> package, leveraging its <code>geom_sf()</code> function which is designed for simple plotting of spatial features stored as <code>sf</code> objects. This produces a clean visualisation of the study area polygon.</p>
<p><strong>Summary of Packages and Functions:</strong></p>
<ul>
<li><p><code>sf::st_read()</code> loads the GeoJSON polygon into R as an <code>sf</code> object.</p></li>
<li><p><code>sf::st_transform()</code> projects the geometry to a CRS in metres (for spatial operations).</p></li>
<li><p><code>ggplot2::ggplot()</code> with <code>geom_sf()</code> visualises the spatial object.</p></li>
</ul>
<p>This workflow establishes a ready-to-use, projected (<code>sf</code>) version of our study area for further spatial sampling steps.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>study_area <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"starter.geojson"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3857</span>)  <span class="co"># Transform to projected CRS if needed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `starter' from data source 
  `C:\Users\00760770\Documents\GitHub\SQ4013\starter.geojson' 
  using driver `GeoJSON'
Simple feature collection with 1 feature and 0 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -2.432683 ymin: 52.77087 xmax: -2.42346 ymax: 52.77471
Geodetic CRS:  WGS 84</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>study_area</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 0 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -270805 ymin: 6940727 xmax: -269778.3 ymax: 6941434
Projected CRS: WGS 84 / Pseudo-Mercator
                        geometry
1 POLYGON ((-269778.3 6941172...</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> study_area, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Study Area Polygon"</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-study-area-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Study area polygon.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="creating-a-regular-grid-over-the-polygon" class="level1">
<h1>3. Creating a regular grid over the polygon</h1>
<p>To perform spatial sampling, we need a set of distinct, spatially-defined <em>sampling units</em> within our study area. Rather than randomly picking arbitrary points, it’s much more structured and reproducible to overlay a <strong>regular grid</strong> of cells (often squares) over the polygon. Each cell then represents a possible sampling unit.</p>
<p><strong>Why create a grid?</strong></p>
<ul>
<li><p><strong>Sampling Frame</strong>: The grid provides a <em>sampling frame</em> of discrete, countable units, ensuring every part of the study area has a clear chance to be included in the sample.</p></li>
<li><p><strong>Spatial Representation</strong>: It helps translate abstract sampling concepts (like “Simple Random Sample”) into concrete spatial terms—cells are equivalent to population members in survey sampling.</p></li>
<li><p><strong>Versatility</strong>: The grid supports stratified, cluster, and systematic sampling, and is easy to adapt for spatial analyses or visualisation.</p></li>
<li><p><strong>Geometric Compatibility</strong>: Regular cell shapes (squares) simplify measurement, distance, coverage checks, and stratification.</p></li>
</ul>
<p>Without a grid (i.e., just sampling random points), it is difficult to control for spatial distribution, equal-area representation, or to implement more advanced sampling strategies. The grid is a foundation for <em>all downstream steps</em>—it allows us to choose sample cells (or their centroids), visualise inclusion, and later allocate samples to specific locations, all within a reproducible framework.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>cell_size <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>grid_raw <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  study_area,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellsize =</span> cell_size,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">square   =</span> <span class="cn">TRUE</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>grid_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">cell_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(grid_raw), <span class="at">geometry =</span> grid_raw) <span class="sc">|&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(study_area)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>grid_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 628 features and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -270805 ymin: 6940727 xmax: -269778.3 ymax: 6941434
Projected CRS: WGS 84 / Pseudo-Mercator
First 10 features:
    cell_id                       geometry
22       22 POLYGON ((-270255 6940752, ...
23       23 POLYGON ((-270255 6940752, ...
24       24 POLYGON ((-270230 6940752, ...
63       63 POLYGON ((-270280 6940777, ...
64       64 POLYGON ((-270280 6940777, ...
65       65 POLYGON ((-270255 6940777, ...
66       66 POLYGON ((-270230 6940752, ...
67       67 POLYGON ((-270205 6940777, ...
103     103 POLYGON ((-270330 6940802, ...
104     104 POLYGON ((-270330 6940802, ...</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> study_area, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Grid Over Study Area"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-grid-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Grid cells intersecting the study area.</figcaption>
</figure>
</div>
</div>
</div>
<section id="creating-centroids" class="level2">
<h2 class="anchored" data-anchor-id="creating-centroids">3.1 Creating centroids</h2>
<p><strong>Why do we create centroids if we already have a grid?</strong></p>
<p>While the grid defines <em>cells</em> (the spatial sampling units), centroids provide a simple, representative <em>point</em> within each cell. There are several reasons why working with centroids is often preferred in practice:</p>
<ul>
<li><p><strong>Simplicity</strong>: Centroids reduce each (sometimes complex) polygonal cell to just a single (x, y) coordinate, making calculations, visualisation, and point-based sampling straightforward.</p></li>
<li><p><strong>Homogeneity Assumption</strong>: In most grid sampling applications, we assume the conditions inside each cell are sufficiently homogeneous for the centroid to represent the whole cell (“quadrat” approach). This means any measurement at the centroid is considered “typical” of the cell.</p></li>
<li><p><strong>Statistical Compatibility</strong>: Many statistical and geostatistical methods require point data or simpler spatial relationships, which centroids provide.</p></li>
<li><p><strong>Sampling Practicality</strong>: It’s operationally easier to visit or target a coordinate (the centroid) than a whole area, especially in field or remote sensing sampling.</p></li>
</ul>
<p><strong>Composite sampling in every quadrat (cell)</strong></p>
<p>However, scientists often recommend <strong>composite sampling</strong> within each quadrat: Instead of measuring only at the centroid, you take multiple (sub-)samples at various spots within the cell and average (or pool) their values. This makes the sample more representative of the cell:</p>
<ul>
<li><p><strong>Reduces micro-scale bias</strong>: A single point might miss local heterogeneity, while a composite (e.g., averaging 3+ sub-samples per cell) reflects cell-wide conditions.</p></li>
<li><p><strong>Improved inference</strong>: Composite samples ensure the grid-cell truly represents an area, not just the conditions at its centre.</p></li>
</ul>
<p>In summary: Centroids are practical and serve as a default representative location for each cell, but composite sampling within quadrats is often advised for a more robust, area-based spatial sample.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>grid_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(grid_sf)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>grid_centroids <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>grid_centroids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 628 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -270790.9 ymin: 6940743 xmax: -269779.5 ymax: 6941430
Projected CRS: WGS 84 / Pseudo-Mercator
First 10 features:
    cell_id                  geometry         x       y
22       22 POINT (-270258.3 6940750) -270258.3 6940750
23       23 POINT (-270240.2 6940743) -270240.2 6940743
24       24 POINT (-270225.4 6940744) -270225.4 6940744
63       63 POINT (-270286.2 6940772) -270286.2 6940772
64       64 POINT (-270266.4 6940766) -270266.4 6940766
65       65 POINT (-270242.5 6940764) -270242.5 6940764
66       66 POINT (-270219.3 6940766) -270219.3 6940766
67       67 POINT (-270203.8 6940775) -270203.8 6940775
103     103 POINT (-270330.8 6940801) -270330.8 6940801
104     104   POINT (-270314 6940795) -270314.0 6940795</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_centroids, <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Grid Centroids"</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-centroids-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Grid centroids representing sampling units.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="simple-random-sampling" class="level1">
<h1>4. Simple random sampling</h1>
<section id="simple-random-sampling-srs" class="level2">
<h2 class="anchored" data-anchor-id="simple-random-sampling-srs">4. Simple Random Sampling (SRS)</h2>
<p>Simple Random Sampling (SRS) is the simplest probability-based sampling design. In SRS, each possible sampling unit (here, each grid cell or its centroid) has an <strong>equal probability</strong> of being selected. There is no stratification, clustering, or any imposed structure — cells are chosen entirely at random.</p>
<section id="key-features-of-srs" class="level3">
<h3 class="anchored" data-anchor-id="key-features-of-srs">Key features of SRS:</h3>
<ul>
<li><p><strong>Equal Probability:</strong> Every cell in the grid frame has the same chance of inclusion.</p></li>
<li><p><strong>Independence:</strong> The selection of one cell does <em>not</em> affect the selection of any other; there are no restrictions.</p></li>
<li><p><strong>Simplicity:</strong> SRS is easy to implement and analyse statistically, with many estimators and confidence intervals relying on its properties.</p></li>
</ul>
</section>
<section id="how-its-used" class="level3">
<h3 class="anchored" data-anchor-id="how-its-used">How it’s used:</h3>
<ul>
<li><p>You specify a desired sample size, say, \( n = 10 \).</p></li>
<li><p>Randomly select \( n \) cells (or centroids) from the full set of available grid cells.</p></li>
<li><p>Each selected cell forms part of your sample for field measurement or further study.</p></li>
</ul>
<p><strong>When is SRS appropriate?</strong></p>
<ul>
<li><p>When the sampling frame is homogeneous, or when there is no strong motivation to incorporate additional structure (like stratification or clustering).</p></li>
<li><p>For pilot studies or when simplicity and unbiasedness are the priorities.</p></li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li><p>If the study area has strong environmental gradients or is heterogeneous, SRS may result in poor representation of certain sub-regions.</p></li>
<li><p>May lead to spatially “clumped” samples purely by chance (less spatial coverage).</p></li>
</ul>
<p>The next code block will implement SRS on the centroids within the study area grid.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>n_srs <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>srs_sample <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(n_srs) <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(cell_id)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>srs_cells <span class="ot">&lt;-</span> grid_sf <span class="sc">|&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cell_id <span class="sc">%in%</span> srs_sample)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>srs_points <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cell_id <span class="sc">%in%</span> srs_sample)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>srs_cells</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 10 features and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -270730 ymin: 6940902 xmax: -269880 ymax: 6941418
Projected CRS: WGS 84 / Pseudo-Mercator
   cell_id                       geometry
1      298 POLYGON ((-270730 6940927, ...
2      317 POLYGON ((-270255 6940927, ...
3      320 POLYGON ((-270180 6940927, ...
4      322 POLYGON ((-270130 6940902, ...
5      557 POLYGON ((-270555 6941077, ...
6      571 POLYGON ((-270205 6941077, ...
7      619 POLYGON ((-270055 6941102, ...
8      709 POLYGON ((-269905 6941152, ...
9     1044 POLYGON ((-269930 6941327, ...
10    1164 POLYGON ((-270055 6941402, ...</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> srs_cells, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> srs_points, <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Simple Random Sample"</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-srs-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Simple random sample of cells and centroids.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="stratified-sampling" class="level1">
<h1>5. Stratified sampling</h1>
<section id="what-is-stratified-sampling" class="level2">
<h2 class="anchored" data-anchor-id="what-is-stratified-sampling">What is stratified sampling?</h2>
<p>Stratified sampling is a probability-based sampling technique in which the entire population (here, the area to be sampled) is divided into <strong>non-overlapping subgroups</strong>, called <strong>strata</strong>, based on a chosen characteristic (stratification variable). Each stratum is <strong>internally homogeneous</strong> (similar within), but <strong>distinct from other strata</strong> (different between strata). The key idea is to ensure that the sample <strong>represents all parts of the population</strong>, especially subgroups that may otherwise be under- (or over-) represented if using simple random sampling.</p>
<p>In spatial studies, common strata are based on geography (e.g., north/south, ecological zones, land cover types, altitude bands), administrative units, or other relevant variables. Stratified sampling is especially valuable if the variable of interest is expected to <strong>vary systematically across strata</strong>.</p>
<p><strong>How does stratified sampling work?</strong></p>
<ol type="1">
<li><p><strong>Define strata:</strong> Partition your population (here: grid cells covering the study area) into subsets. In our example, we use a median split on the ‘y’ coordinate, dividing the area into “North” and “South” strata.</p></li>
<li><p><strong>Decide sample size per stratum:</strong> This can be <em>proportional</em> (sample size per stratum proportional to stratum size), or <em>equal</em> allocation, or other allocation rules. Proportional allocation is very common.</p></li>
<li><p><strong>Random sample within strata:</strong> For each stratum, select the desired number of units randomly.</p></li>
</ol>
<p><strong>Advantages:</strong></p>
<ul>
<li><p>Ensures all sub-regions are represented.</p></li>
<li><p>Can yield more precise (lower-variance) estimates if strata are meaningful.</p></li>
<li><p>Reduces risk of missing rare or important sub-populations.</p></li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li><p>Requires information to define suitable strata.</p></li>
<li><p>More complex to design and implement than SRS.</p></li>
</ul>
<hr>
</section>
<section id="how-is-stratified-sampling-implemented-here" class="level2">
<h2 class="anchored" data-anchor-id="how-is-stratified-sampling-implemented-here">How is stratified sampling implemented here?</h2>
<p>In the code below, stratified sampling is implemented in a stepwise fashion:</p>
<ol type="1">
<li><p><strong>Create strata:</strong><br>
The code first calculates the median ‘y’ coordinate (i.e., latitude-like position) of grid centroids, then assigns each centroid to “North” (if <code>y &gt;= median</code>) or “South” (otherwise). This creates <em>North/South strata</em> that split the area horizontally.</p></li>
<li><p><strong>Count grid cells per stratum:</strong><br>
The number of grid centroids in each stratum is counted. These counts determine the proportional allocation for sampling.</p></li>
<li><p><strong>Determine proportional sample sizes:</strong><br>
Given a desired <em>total</em> sample size (e.g., <code>n_total &lt;- 20</code>), each stratum is allocated a sample size proportional to its share of the total grid (rounded). For example, if “North” contains 44% of all grid cells, it receives 44% of the sample.</p></li>
<li><p><strong>Draw stratified random samples:</strong><br>
For each stratum, the code randomly selects the corresponding number of units (using <code>sample_n()</code>), ensuring every stratum is represented.</p></li>
</ol>
<p>This ensures that sampling is geographically balanced (here, by north/south position), and that every sub-region gets sampled fairly relative to its size.</p>
<p><strong>In summary:</strong><br>
Stratified sampling divides the sampling frame according to a chosen characteristic, then randomly samples <em>within</em> each stratum, with allocation (how many per stratum) according to the stratum’s relative size. The implementation here is spatially intuitive and ensures both “North” and “South” gets covered.</p>
</section>
<section id="creating-strata" class="level2">
<h2 class="anchored" data-anchor-id="creating-strata">5.1 Creating strata</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>y_median <span class="ot">&lt;-</span> <span class="fu">median</span>(grid_centroids<span class="sc">$</span>y)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>grid_centroids <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">stratum_ns =</span> <span class="fu">ifelse</span>(y <span class="sc">&gt;=</span> y_median, <span class="st">"North"</span>, <span class="st">"South"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stratum_ns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  stratum_ns   n
1      North 329
2      South 299</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_centroids, <span class="fu">aes</span>(<span class="at">colour =</span> stratum_ns), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Strata: North vs South"</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-strata-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>North/South strata.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="proportional-stratified-sampling" class="level2">
<h2 class="anchored" data-anchor-id="proportional-stratified-sampling">5.2 Proportional stratified sampling</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>n_total <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>stratum_counts <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stratum_ns) <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_stratum =</span> <span class="fu">round</span>(prop <span class="sc">*</span> n_total))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>stratum_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  stratum_ns   n      prop n_stratum
1      North 329 0.5238854        10
2      South 299 0.4761146        10</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>strat_sample_ids <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(stratum_counts, <span class="at">by =</span> <span class="st">"stratum_ns"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stratum_ns) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">slice_sample</span>(.x, <span class="at">n =</span> .x<span class="sc">$</span>n_stratum[<span class="dv">1</span>])) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(cell_id)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>strat_cells <span class="ot">&lt;-</span> grid_sf <span class="sc">|&gt;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cell_id <span class="sc">%in%</span> strat_sample_ids)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>strat_points <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cell_id <span class="sc">%in%</span> strat_sample_ids)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>strat_cells</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 20 features and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -270755 ymin: 6940852 xmax: -269905 ymax: 6941252
Projected CRS: WGS 84 / Pseudo-Mercator
First 10 features:
   cell_id                       geometry
1      230 POLYGON ((-270330 6940877, ...
2      298 POLYGON ((-270730 6940927, ...
3      341 POLYGON ((-270705 6940952, ...
4      348 POLYGON ((-270530 6940952, ...
5      350 POLYGON ((-270480 6940952, ...
6      364 POLYGON ((-270130 6940927, ...
7      434 POLYGON ((-270480 6941002, ...
8      441 POLYGON ((-270305 6941002, ...
9      507 POLYGON ((-270755 6941052, ...
10     537 POLYGON ((-270005 6941027, ...</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> strat_cells, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> strat_points, <span class="fu">aes</span>(<span class="at">colour =</span> stratum_ns), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Stratified Sample"</span>) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-stratified-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Stratified sample.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cluster-sampling" class="level1">
<h1>6. Cluster sampling</h1>
<p>Cluster sampling is a technique used in survey sampling where the population is divided into groups—called clusters—that are each intended to be “mini-populations” representing the population as a whole. Instead of sampling individuals directly from the full population, whole clusters are randomly selected, and then all (or a sample of) units within those clusters are surveyed. This approach is particularly useful when:</p>
<ul>
<li><p>The population is large and geographically dispersed,</p></li>
<li><p>Collecting a simple random sample would be costly or logistically complex,</p></li>
<li><p>Natural groupings already exist (e.g., schools, villages, spatial grid regions).</p></li>
</ul>
<p><strong>Key features of cluster sampling:</strong></p>
<ul>
<li><p><strong>Clusters are ideally heterogeneous:</strong> Each cluster should be as representative as possible of the overall population. If clusters differ greatly, cluster sampling can increase sampling error.</p></li>
<li><p><strong>Sampling happens in stages:</strong> First, a subset of clusters is selected at random. Then, data are collected from all or a sample of units within those clusters.</p></li>
<li><p><strong>Design effects:</strong> Estimates from cluster samples need to take clustering into account during statistical analysis, as individuals within the same cluster are often more similar to each other.</p></li>
</ul>
<p><strong>How is cluster sampling implemented here?</strong></p>
<p>In this example, the spatial grid is first divided into clusters based on cell locations. We:</p>
<ol type="1">
<li><p><strong>Assign cluster IDs:</strong> Grid cells are grouped together into clusters by location (see code in the <code>create-clusters</code> chunk).</p></li>
<li><p><strong>Summarise clusters:</strong> The number of cells in each cluster is counted.</p></li>
<li><p><strong>Randomly select clusters:</strong> A fixed number of clusters are chosen at random (see the <code>cluster-sampling</code> chunk).</p></li>
<li><p><strong>Sample within clusters:</strong> For each selected cluster, a specified number of cells are drawn (see the following code chunk).</p></li>
<li><p><strong>Visualise the sample:</strong> On a map, you can see which clusters (and cells within clusters) were selected.</p></li>
</ol>
<p>This approach reduces costs by focusing effort in a limited number of locations while still allowing for statistical inference, provided proper analysis methods are used to account for the clustering.</p>
<section id="creating-clusters" class="level2">
<h2 class="anchored" data-anchor-id="creating-clusters">6.1 Creating clusters</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cluster_size <span class="ot">&lt;-</span> cell_size <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>grid_centroids <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_x =</span> <span class="fu">floor</span>((x <span class="sc">-</span> <span class="fu">min</span>(x)) <span class="sc">/</span> cluster_size),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_y =</span> <span class="fu">floor</span>((y <span class="sc">-</span> <span class="fu">min</span>(y)) <span class="sc">/</span> cluster_size),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_id =</span> <span class="fu">paste</span>(cluster_x, cluster_y, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>cluster_summary <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cluster_id, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>cluster_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    cluster_id n
1          9_1 7
2          0_3 6
3          0_4 6
4          0_5 6
5          0_6 6
6         10_0 6
7         11_0 6
8         14_5 6
9          2_3 6
10         3_3 6
11         4_3 6
12         5_3 6
13         7_2 6
14       11_11 5
15       13_12 5
16        13_4 5
17        16_6 5
18        17_7 5
19        19_8 5
20         5_8 5
21         6_3 5
22         7_9 5
23         8_2 5
24        9_10 5
25        10_1 4
26       10_10 4
27        10_2 4
28        10_3 4
29        10_4 4
30        10_5 4
31        10_6 4
32        10_7 4
33        10_8 4
34        10_9 4
35        11_1 4
36       11_10 4
37        11_2 4
38        11_3 4
39        11_4 4
40        11_5 4
41        11_6 4
42        11_7 4
43        11_8 4
44        11_9 4
45       12_10 4
46       12_11 4
47        12_2 4
48        12_3 4
49        12_4 4
50        12_5 4
51        12_6 4
52        12_7 4
53        12_8 4
54        12_9 4
55       13_10 4
56       13_11 4
57        13_5 4
58        13_6 4
59        13_7 4
60        13_8 4
61        13_9 4
62       14_10 4
63       14_11 4
64       14_12 4
65        14_6 4
66        14_7 4
67        14_8 4
68        14_9 4
69       15_10 4
70       15_11 4
71       15_12 4
72       15_13 4
73        15_5 4
74        15_6 4
75        15_7 4
76        15_8 4
77        15_9 4
78       16_10 4
79       16_11 4
80        16_7 4
81        16_8 4
82        16_9 4
83       17_10 4
84        17_8 4
85        17_9 4
86        18_7 4
87        18_8 4
88        18_9 4
89         1_3 4
90         1_4 4
91         1_5 4
92         1_6 4
93         2_4 4
94         2_5 4
95         2_6 4
96         2_7 4
97         3_4 4
98         3_5 4
99         3_6 4
100        3_7 4
101        4_4 4
102        4_5 4
103        4_6 4
104        4_7 4
105        4_8 4
106        5_4 4
107        5_5 4
108        5_6 4
109        5_7 4
110        6_4 4
111        6_5 4
112        6_6 4
113        6_7 4
114        6_8 4
115        6_9 4
116        7_3 4
117        7_4 4
118        7_5 4
119        7_6 4
120        7_7 4
121        7_8 4
122       8_10 4
123        8_3 4
124        8_4 4
125        8_5 4
126        8_6 4
127        8_7 4
128        8_8 4
129        8_9 4
130        9_2 4
131        9_3 4
132        9_4 4
133        9_5 4
134        9_6 4
135        9_7 4
136        9_8 4
137        9_9 4
138        0_2 3
139      10_11 3
140      12_12 3
141       13_3 3
142      14_13 3
143      16_12 3
144      17_11 3
145      18_10 3
146        8_1 3
147       12_1 2
148       17_6 2
149       19_9 2
150        1_2 2
151        1_7 2
152       20_8 1
153        3_8 1
154        5_9 1
155       7_10 1
156        9_0 1</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_centroids, <span class="fu">aes</span>(<span class="at">colour =</span> cluster_id), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Clusters"</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-clusters-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Clusters of grid cells.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sampling-clusters" class="level2">
<h2 class="anchored" data-anchor-id="sampling-clusters">6.2 Sampling clusters</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>n_clusters_to_sample <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>n_cells_per_cluster  <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>clusters_to_sample <span class="ot">&lt;-</span> cluster_summary <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_clusters_to_sample) <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(cluster_id)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>clusters_to_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "12_4" "4_5"  "12_6"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cluster_sample_ids <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cluster_id <span class="sc">%in%</span> clusters_to_sample) <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_id) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_cells_per_cluster) <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(cell_id)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>cluster_cells <span class="ot">&lt;-</span> grid_sf <span class="sc">|&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cell_id <span class="sc">%in%</span> cluster_sample_ids)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>cluster_points <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cell_id <span class="sc">%in%</span> cluster_sample_ids)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>cluster_cells</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 9 features and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -270580 ymin: 6940952 xmax: -270130 ymax: 6941102
Projected CRS: WGS 84 / Pseudo-Mercator
  cell_id                       geometry
1     404 POLYGON ((-270180 6940977, ...
2     405 POLYGON ((-270155 6940977, ...
3     446 POLYGON ((-270180 6941002, ...
4     472 POLYGON ((-270580 6941027, ...
5     473 POLYGON ((-270555 6941027, ...
6     515 POLYGON ((-270555 6941052, ...
7     572 POLYGON ((-270180 6941077, ...
8     614 POLYGON ((-270180 6941102, ...
9     615 POLYGON ((-270155 6941102, ...</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>all_cells_in_sampled_clusters <span class="ot">&lt;-</span> grid_centroids <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cluster_id <span class="sc">%in%</span> clusters_to_sample) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(cell_id)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>clusters_all_cells <span class="ot">&lt;-</span> grid_sf <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cell_id <span class="sc">%in%</span> all_cells_in_sampled_clusters)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> clusters_all_cells, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> cluster_cells, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> cluster_points, <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Cluster Sampling"</span>) <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-cluster-sample-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Cluster sample.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="generating-random-points-within-sampled-cells" class="level1">
<h1>7. Generating random points within sampled cells</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>random_point_in_polygon <span class="ot">&lt;-</span> <span class="cf">function</span>(poly, <span class="at">n =</span> <span class="dv">1</span>) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sample</span>(poly, <span class="at">size =</span> n, <span class="at">type =</span> <span class="st">"random"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>srs_random_points_geom <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>(srs_cells),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">random_point_in_polygon</span>(.x, <span class="at">n =</span> <span class="dv">1</span>)[[<span class="dv">1</span>]]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(study_area))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>srs_random_points <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_id =</span> srs_cells<span class="sc">$</span>cell_id,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">geometry =</span> srs_random_points_geom</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>srs_random_points</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 10 features and 1 field
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -270729.7 ymin: 6940904 xmax: -269901 ymax: 6941407
Projected CRS: WGS 84 / Pseudo-Mercator
   cell_id                  geometry
1      298 POINT (-270729.7 6940921)
2      317 POINT (-270252.8 6940915)
3      320 POINT (-270170.4 6940904)
4      322 POINT (-270124.2 6940925)
5      557 POINT (-270551.5 6941066)
6      571 POINT (-270200.1 6941074)
7      619 POINT (-270045.3 6941085)
8      709   POINT (-269901 6941149)
9     1044 POINT (-269928.7 6941328)
10    1164 POINT (-270077.4 6941407)</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> grid_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> srs_cells, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> srs_random_points, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Random Points within Sampled Cells"</span>) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="samplingtut_files/figure-html/plot-srs-random-points-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Random points in SRS cells.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="exercises" class="level1">
<h1>8. Exercises</h1>
<ol type="1">
<li>Change <code>cell_size</code> and re-run the grid creation.</li>
<li>Create three strata instead of two.</li>
<li>Adjust <code>cluster_size</code> and compare.</li>
<li>Generate two random points per sampled cell.</li>
<li>Export results using <code>st_write()</code>.</li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>