<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Harper Adams University">

<title>Regression tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="regression_tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="regression_tutorial_files/libs/quarto-html/quarto.js"></script>
<script src="regression_tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="regression_tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="regression_tutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="regression_tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="regression_tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="regression_tutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="regression_tutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="regression_tutorial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="scroll.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#part-1-simple-linear-regression" id="toc-part-1-simple-linear-regression" class="nav-link" data-scroll-target="#part-1-simple-linear-regression">Part 1: Simple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#the-question-does-bill-length-predict-body-mass" id="toc-the-question-does-bill-length-predict-body-mass" class="nav-link" data-scroll-target="#the-question-does-bill-length-predict-body-mass">The Question: Does bill length predict body mass?</a>
  <ul class="collapse">
  <li><a href="#step-1-always-plot-your-data-first" id="toc-step-1-always-plot-your-data-first" class="nav-link" data-scroll-target="#step-1-always-plot-your-data-first">Step 1: Always plot your data first</a></li>
  <li><a href="#step-2-fit-the-model" id="toc-step-2-fit-the-model" class="nav-link" data-scroll-target="#step-2-fit-the-model">Step 2: Fit the model</a></li>
  <li><a href="#step-3-look-at-the-output" id="toc-step-3-look-at-the-output" class="nav-link" data-scroll-target="#step-3-look-at-the-output">Step 3: Look at the output</a></li>
  <li><a href="#step-4-extract-and-interpret-the-coefficients" id="toc-step-4-extract-and-interpret-the-coefficients" class="nav-link" data-scroll-target="#step-4-extract-and-interpret-the-coefficients">Step 4: Extract and interpret the coefficients</a></li>
  <li><a href="#step-5-get-r-squared" id="toc-step-5-get-r-squared" class="nav-link" data-scroll-target="#step-5-get-r-squared">Step 5: Get R-squared</a></li>
  <li><a href="#step-6-add-the-regression-line-to-our-plot" id="toc-step-6-add-the-regression-line-to-our-plot" class="nav-link" data-scroll-target="#step-6-add-the-regression-line-to-our-plot">Step 6: Add the regression line to our plot</a></li>
  <li><a href="#step-7-understand-predictions-and-residuals" id="toc-step-7-understand-predictions-and-residuals" class="nav-link" data-scroll-target="#step-7-understand-predictions-and-residuals">Step 7: Understand predictions and residuals</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#part-2-multiple-regression" id="toc-part-2-multiple-regression" class="nav-link" data-scroll-target="#part-2-multiple-regression">Part 2: Multiple Regression</a>
  <ul class="collapse">
  <li><a href="#the-question-does-adding-flipper-length-improve-our-predictions" id="toc-the-question-does-adding-flipper-length-improve-our-predictions" class="nav-link" data-scroll-target="#the-question-does-adding-flipper-length-improve-our-predictions">The Question: Does adding flipper length improve our predictions?</a>
  <ul class="collapse">
  <li><a href="#step-1-visualize-both-predictors" id="toc-step-1-visualize-both-predictors" class="nav-link" data-scroll-target="#step-1-visualize-both-predictors">Step 1: Visualize both predictors</a></li>
  <li><a href="#step-2-fit-the-multiple-regression" id="toc-step-2-fit-the-multiple-regression" class="nav-link" data-scroll-target="#step-2-fit-the-multiple-regression">Step 2: Fit the multiple regression</a></li>
  <li><a href="#step-3-interpret-the-coefficients-carefully" id="toc-step-3-interpret-the-coefficients-carefully" class="nav-link" data-scroll-target="#step-3-interpret-the-coefficients-carefully">Step 3: Interpret the coefficients carefully</a></li>
  <li><a href="#step-4-compare-model-fit" id="toc-step-4-compare-model-fit" class="nav-link" data-scroll-target="#step-4-compare-model-fit">Step 4: Compare model fit</a></li>
  <li><a href="#step-5-formal-model-comparison" id="toc-step-5-formal-model-comparison" class="nav-link" data-scroll-target="#step-5-formal-model-comparison">Step 5: Formal model comparison</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#part-3-interactions" id="toc-part-3-interactions" class="nav-link" data-scroll-target="#part-3-interactions">Part 3: Interactions</a>
  <ul class="collapse">
  <li><a href="#the-question-does-the-bill-length-effect-differ-by-species" id="toc-the-question-does-the-bill-length-effect-differ-by-species" class="nav-link" data-scroll-target="#the-question-does-the-bill-length-effect-differ-by-species">The Question: Does the bill-length effect differ by species?</a>
  <ul class="collapse">
  <li><a href="#step-1-plot-by-species" id="toc-step-1-plot-by-species" class="nav-link" data-scroll-target="#step-1-plot-by-species">Step 1: Plot by species</a></li>
  <li><a href="#step-2-fit-the-interaction-model" id="toc-step-2-fit-the-interaction-model" class="nav-link" data-scroll-target="#step-2-fit-the-interaction-model">Step 2: Fit the interaction model</a></li>
  <li><a href="#step-3-interpret-interaction-coefficients" id="toc-step-3-interpret-interaction-coefficients" class="nav-link" data-scroll-target="#step-3-interpret-interaction-coefficients">Step 3: Interpret interaction coefficients</a></li>
  <li><a href="#step-4-do-we-need-the-interaction" id="toc-step-4-do-we-need-the-interaction" class="nav-link" data-scroll-target="#step-4-do-we-need-the-interaction">Step 4: Do we need the interaction?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#part-4-anova-is-just-regression" id="toc-part-4-anova-is-just-regression" class="nav-link" data-scroll-target="#part-4-anova-is-just-regression">Part 4: ANOVA is Just Regression</a>
  <ul class="collapse">
  <li><a href="#the-big-reveal-anova-regression-with-categorical-predictors" id="toc-the-big-reveal-anova-regression-with-categorical-predictors" class="nav-link" data-scroll-target="#the-big-reveal-anova-regression-with-categorical-predictors">The Big Reveal: ANOVA = Regression with categorical predictors</a>
  <ul class="collapse">
  <li><a href="#traditional-anova-approach" id="toc-traditional-anova-approach" class="nav-link" data-scroll-target="#traditional-anova-approach">Traditional ANOVA approach</a></li>
  <li><a href="#regression-approach" id="toc-regression-approach" class="nav-link" data-scroll-target="#regression-approach">Regression approach</a></li>
  <li><a href="#theyre-identical" id="toc-theyre-identical" class="nav-link" data-scroll-target="#theyre-identical">They’re identical!</a></li>
  <li><a href="#what-do-the-regression-coefficients-mean" id="toc-what-do-the-regression-coefficients-mean" class="nav-link" data-scroll-target="#what-do-the-regression-coefficients-mean">What do the regression coefficients mean?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#part-5-checking-your-model-diagnostics" id="toc-part-5-checking-your-model-diagnostics" class="nav-link" data-scroll-target="#part-5-checking-your-model-diagnostics">Part 5: Checking Your Model (Diagnostics)</a>
  <ul class="collapse">
  <li><a href="#why-diagnostics-matter" id="toc-why-diagnostics-matter" class="nav-link" data-scroll-target="#why-diagnostics-matter">Why diagnostics matter</a>
  <ul class="collapse">
  <li><a href="#the-four-diagnostic-plots" id="toc-the-four-diagnostic-plots" class="nav-link" data-scroll-target="#the-four-diagnostic-plots">The four diagnostic plots</a></li>
  <li><a href="#how-to-read-each-plot" id="toc-how-to-read-each-plot" class="nav-link" data-scroll-target="#how-to-read-each-plot">How to read each plot</a></li>
  <li><a href="#what-does-model2-look-like" id="toc-what-does-model2-look-like" class="nav-link" data-scroll-target="#what-does-model2-look-like">What does model2 look like?</a></li>
  <li><a href="#when-things-go-wrong-an-example" id="toc-when-things-go-wrong-an-example" class="nav-link" data-scroll-target="#when-things-go-wrong-an-example">When things go wrong: An example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#summary-the-essential-r-commands" id="toc-summary-the-essential-r-commands" class="nav-link" data-scroll-target="#summary-the-essential-r-commands">Summary: The Essential R Commands</a></li>
  <li><a href="#practice-exercises" id="toc-practice-exercises" class="nav-link" data-scroll-target="#practice-exercises">Practice Exercises</a></li>
  <li><a href="#what-youve-learned" id="toc-what-youve-learned" class="nav-link" data-scroll-target="#what-youve-learned">What You’ve Learned</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Regression tutorial</h1>
<p class="subtitle lead">Step-by-step practical guide</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Harper Adams University </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>We’ll keep this simple. Just three essential packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)      <span class="co"># for pretty plots</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)        <span class="co"># for data wrangling</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)  <span class="co"># our dataset</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data and remove rows with missing values</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(penguins)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bill_length_mm), </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(body_mass_g), </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(species),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(flipper_length_mm))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a quick look</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 15%">
<col style="width: 20%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: left;">island</th>
<th style="text-align: right;">bill_length_mm</th>
<th style="text-align: right;">bill_depth_mm</th>
<th style="text-align: right;">flipper_length_mm</th>
<th style="text-align: right;">body_mass_g</th>
<th style="text-align: left;">sex</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.1</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">3750</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.5</td>
<td style="text-align: right;">17.4</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">3800</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">40.3</td>
<td style="text-align: right;">18.0</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">3250</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">36.7</td>
<td style="text-align: right;">19.3</td>
<td style="text-align: right;">193</td>
<td style="text-align: right;">3450</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.3</td>
<td style="text-align: right;">20.6</td>
<td style="text-align: right;">190</td>
<td style="text-align: right;">3650</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">2007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">38.9</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">3625</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">2007</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>What we’re looking at:</strong> Data on 333 penguins from three species. We’ll use their physical measurements to understand regression.</p>
<hr>
</section>
<section id="part-1-simple-linear-regression" class="level1">
<h1>Part 1: Simple Linear Regression</h1>
<section id="the-question-does-bill-length-predict-body-mass" class="level2">
<h2 class="anchored" data-anchor-id="the-question-does-bill-length-predict-body-mass">The Question: Does bill length predict body mass?</h2>
<p>Let’s start with the most basic regression: one predictor, one outcome.</p>
<section id="step-1-always-plot-your-data-first" class="level3">
<h3 class="anchored" data-anchor-id="step-1-always-plot-your-data-first">Step 1: Always plot your data first</h3>
<p>Never fit a model before looking at your data. Seriously, never.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a scatter plot</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm, <span class="at">y =</span> body_mass_g)) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Bill length (mm)"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Body mass (g)"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Do penguins with longer bills weigh more?"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_tutorial_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>What do we see?</strong> There’s definitely a positive relationship—longer bills tend to go with heavier penguins. But there’s a lot of scatter. Let’s quantify this relationship with regression.</p>
</section>
<section id="step-2-fit-the-model" class="level3">
<h3 class="anchored" data-anchor-id="step-2-fit-the-model">Step 2: Fit the model</h3>
<p>The <code>lm()</code> function fits a <strong>l</strong>inear <strong>m</strong>odel. The formula <code>y ~ x</code> means “y is predicted by x”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the regression: body mass predicted by bill length</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm, <span class="at">data =</span> penguins)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The model object is now stored in model1</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see what's inside</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lm"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "coefficients"  "residuals"     "effects"       "rank"         
 [5] "fitted.values" "assign"        "qr"            "df.residual"  
 [9] "xlevels"       "call"          "terms"         "model"        </code></pre>
</div>
</div>
<p><strong>What just happened?</strong> We created a model object called <code>model1</code>. It’s a list containing everything R calculated: coefficients, residuals, fitted values, and more.</p>
</section>
<section id="step-3-look-at-the-output" class="level3">
<h3 class="anchored" data-anchor-id="step-3-look-at-the-output">Step 3: Look at the output</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The summary() function shows us the key results</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ bill_length_mm, data = penguins)

Residuals:
     Min       1Q   Median       3Q      Max 
-1762.08  -446.98    32.59   462.31  1636.86 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     362.307    283.345   1.279    0.202    
bill_length_mm   87.415      6.402  13.654   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 645.4 on 340 degrees of freedom
Multiple R-squared:  0.3542,    Adjusted R-squared:  0.3523 
F-statistic: 186.4 on 1 and 340 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><strong>Let’s break this down:</strong></p>
<ul>
<li><strong>Coefficients table</strong>: Shows our intercept and slope</li>
<li><strong>Residual standard error</strong>: How far off our predictions typically are (645.43g)</li>
<li><strong>R-squared</strong>: Proportion of variance explained (0.35 = 35%)</li>
<li><strong>F-statistic</strong>: Tests if the model is better than just using the mean (it is!)</li>
</ul>
</section>
<section id="step-4-extract-and-interpret-the-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="step-4-extract-and-interpret-the-coefficients">Step 4: Extract and interpret the coefficients</h3>
<p>Instead of just reading the summary, let’s pull out the numbers we need:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the coefficients</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) bill_length_mm 
     362.30672       87.41528 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Or access them directly from the model object</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>model1<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) bill_length_mm 
     362.30672       87.41528 </code></pre>
</div>
</div>
<p><strong>What do these mean?</strong></p>
<ul>
<li><strong>Intercept = 362.31</strong>: A penguin with 0mm bill length would weigh 362.31g. (Obviously impossible—this is just where the line crosses the y-axis)</li>
<li><strong>Slope = 87.42</strong>: For every 1mm increase in bill length, body mass increases by <strong>87.42 grams</strong> on average</li>
</ul>
<p>Let’s get confidence intervals too:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 95% confidence intervals for our coefficients</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ci1 <span class="ot">&lt;-</span> <span class="fu">confint</span>(model1)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ci1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    2.5 %   97.5 %
(Intercept)    -195.02364 919.6371
bill_length_mm   74.82279 100.0078</code></pre>
</div>
</div>
<p>We’re 95% confident the true slope is between 74.82 and 100.01 grams per mm.</p>
</section>
<section id="step-5-get-r-squared" class="level3">
<h3 class="anchored" data-anchor-id="step-5-get-r-squared">Step 5: Get R-squared</h3>
<p>How much of the variation in body mass does bill length explain?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R-squared from the summary</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>r2_model1 <span class="ot">&lt;-</span> <span class="fu">summary</span>(model1)<span class="sc">$</span>r.squared</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>r2_model1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3541557</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For adjusted R-squared</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3522562</code></pre>
</div>
</div>
<p><strong>35% explained.</strong> That means bill length accounts for about a third of why some penguins are heavier than others. Not bad, but there’s clearly more to the story.</p>
</section>
<section id="step-6-add-the-regression-line-to-our-plot" class="level3">
<h3 class="anchored" data-anchor-id="step-6-add-the-regression-line-to-our-plot">Step 6: Add the regression line to our plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm, <span class="at">y =</span> body_mass_g)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Bill length (mm)"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Body mass (g)"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bill length vs body mass with regression line"</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_tutorial_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The shaded area shows our uncertainty about where the true line is.</p>
</section>
<section id="step-7-understand-predictions-and-residuals" class="level3">
<h3 class="anchored" data-anchor-id="step-7-understand-predictions-and-residuals">Step 7: Understand predictions and residuals</h3>
<p>Let’s manually see what the model predicts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get fitted (predicted) values for each penguin</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fitted_values <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model1)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get residuals (observed - predicted)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>residuals_values <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model1)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at first 10 penguins</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">observed =</span> penguins<span class="sc">$</span>body_mass_g[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">predicted =</span> fitted_values[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">residual =</span> residuals_values[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">observed</th>
<th style="text-align: right;">predicted</th>
<th style="text-align: right;">residual</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3750</td>
<td style="text-align: right;">3780.244</td>
<td style="text-align: right;">-30.24405</td>
</tr>
<tr class="even">
<td style="text-align: right;">3800</td>
<td style="text-align: right;">3815.210</td>
<td style="text-align: right;">-15.21017</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3250</td>
<td style="text-align: right;">3885.142</td>
<td style="text-align: right;">-635.14239</td>
</tr>
<tr class="even">
<td style="text-align: right;">3450</td>
<td style="text-align: right;">3570.447</td>
<td style="text-align: right;">-120.44739</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3650</td>
<td style="text-align: right;">3797.727</td>
<td style="text-align: right;">-147.72711</td>
</tr>
<tr class="even">
<td style="text-align: right;">3625</td>
<td style="text-align: right;">3762.761</td>
<td style="text-align: right;">-137.76100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4675</td>
<td style="text-align: right;">3788.986</td>
<td style="text-align: right;">886.01442</td>
</tr>
<tr class="even">
<td style="text-align: right;">3475</td>
<td style="text-align: right;">3343.168</td>
<td style="text-align: right;">131.83233</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4250</td>
<td style="text-align: right;">4033.748</td>
<td style="text-align: right;">216.25164</td>
</tr>
<tr class="even">
<td style="text-align: right;">3300</td>
<td style="text-align: right;">3666.604</td>
<td style="text-align: right;">-366.60419</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>What’s a residual?</strong> It’s how wrong we were. If a penguin weighs 3750g but we predicted 3600g, the residual is +150g. Positive residuals mean we underestimated; negative means we overestimated.</p>
<hr>
</section>
</section>
</section>
<section id="part-2-multiple-regression" class="level1">
<h1>Part 2: Multiple Regression</h1>
<section id="the-question-does-adding-flipper-length-improve-our-predictions" class="level2">
<h2 class="anchored" data-anchor-id="the-question-does-adding-flipper-length-improve-our-predictions">The Question: Does adding flipper length improve our predictions?</h2>
<p>We saw that bill length explains 35% of body mass variation. Can we do better by adding another predictor?</p>
<section id="step-1-visualize-both-predictors" class="level3">
<h3 class="anchored" data-anchor-id="step-1-visualize-both-predictors">Step 1: Visualize both predictors</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create two plots side by side</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm, <span class="at">y =</span> body_mass_g)) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Bill length (mm)"</span>, <span class="at">y =</span> <span class="st">"Body mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> body_mass_g)) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>, <span class="at">y =</span> <span class="st">"Body mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_tutorial_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Both show positive relationships. Now let’s include both in one model.</p>
</section>
<section id="step-2-fit-the-multiple-regression" class="level3">
<h3 class="anchored" data-anchor-id="step-2-fit-the-multiple-regression">Step 2: Fit the multiple regression</h3>
<p>The <code>+</code> sign means “include both predictors”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model with two predictors</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> flipper_length_mm, <span class="at">data =</span> penguins)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ bill_length_mm + flipper_length_mm, 
    data = penguins)

Residuals:
    Min      1Q  Median      3Q     Max 
-1090.5  -285.7   -32.1   244.2  1287.5 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       -5736.897    307.959 -18.629   &lt;2e-16 ***
bill_length_mm        6.047      5.180   1.168    0.244    
flipper_length_mm    48.145      2.011  23.939   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 394.1 on 339 degrees of freedom
Multiple R-squared:   0.76, Adjusted R-squared:  0.7585 
F-statistic: 536.6 on 2 and 339 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="step-3-interpret-the-coefficients-carefully" class="level3">
<h3 class="anchored" data-anchor-id="step-3-interpret-the-coefficients-carefully">Step 3: Interpret the coefficients carefully</h3>
<p>This is where multiple regression gets interesting:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      (Intercept)    bill_length_mm flipper_length_mm 
     -5736.897161          6.047488         48.144859 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ci2 <span class="ot">&lt;-</span> <span class="fu">confint</span>(model2)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ci2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        2.5 %      97.5 %
(Intercept)       -6342.64860 -5131.14573
bill_length_mm       -4.14117    16.23615
flipper_length_mm    44.18902    52.10069</code></pre>
</div>
</div>
<p><strong>What do these mean?</strong></p>
<ul>
<li><strong>bill_length_mm = 6.05</strong>: Holding flipper length constant, a 1mm increase in bill length increases body mass by 6.05g</li>
<li><strong>flipper_length_mm = 48.14</strong>: Holding bill length constant, a 1mm increase in flipper length increases body mass by 48.14g</li>
</ul>
<p><strong>Wait, what happened?</strong> The bill length effect dropped from 87.42g to 6.05g! Why? Because bill length and flipper length are correlated—they both measure “penguin size”. Once we account for flipper length, bill length doesn’t add as much.</p>
</section>
<section id="step-4-compare-model-fit" class="level3">
<h3 class="anchored" data-anchor-id="step-4-compare-model-fit">Step 4: Compare model fit</h3>
<p>Did adding flipper length help?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 R-squared</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>r2_model1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3541557</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 R-squared  </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>r2_model2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(model2)<span class="sc">$</span>r.squared</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>r2_model2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7599577</code></pre>
</div>
</div>
<p><strong>Huge improvement!</strong> We went from 35% to 76% variance explained. Flipper length is clearly an important predictor.</p>
</section>
<section id="step-5-formal-model-comparison" class="level3">
<h3 class="anchored" data-anchor-id="step-5-formal-model-comparison">Step 5: Formal model comparison</h3>
<p>We can test if model2 is significantly better than model1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOVA compares nested models</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">340</td>
<td style="text-align: right;">141638626</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">339</td>
<td style="text-align: right;">52643125</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">88995501</td>
<td style="text-align: right;">573.0943</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Reading the output:</strong> The p-value is tiny (&lt; 0.001), confirming that adding flipper length significantly improves the model.</p>
<hr>
</section>
</section>
</section>
<section id="part-3-interactions" class="level1">
<h1>Part 3: Interactions</h1>
<section id="the-question-does-the-bill-length-effect-differ-by-species" class="level2">
<h2 class="anchored" data-anchor-id="the-question-does-the-bill-length-effect-differ-by-species">The Question: Does the bill-length effect differ by species?</h2>
<p>Maybe the relationship between bill length and body mass isn’t the same for all three species.</p>
<section id="step-1-plot-by-species" class="level3">
<h3 class="anchored" data-anchor-id="step-1-plot-by-species">Step 1: Plot by species</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm, <span class="at">y =</span> body_mass_g, <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Bill length (mm)"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Body mass (g)"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Does the relationship differ by species?"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Species"</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_tutorial_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>What do we see?</strong> Three different regression lines with different slopes. Adelie (pink) has a gentler slope than Gentoo (green). This suggests an <strong>interaction</strong>.</p>
</section>
<section id="step-2-fit-the-interaction-model" class="level3">
<h3 class="anchored" data-anchor-id="step-2-fit-the-interaction-model">Step 2: Fit the interaction model</h3>
<p>The <code>*</code> symbol means “include both main effects AND their interaction”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Main effects + interaction</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">*</span> species, <span class="at">data =</span> penguins)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ bill_length_mm * species, data = penguins)

Residuals:
    Min      1Q  Median      3Q     Max 
-918.76 -245.89   -8.65  238.44 1126.27 

Coefficients:
                                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                        34.88     443.18   0.079    0.937    
bill_length_mm                     94.50      11.40   8.291 2.73e-15 ***
speciesChinstrap                  811.26     799.81   1.014    0.311    
speciesGentoo                    -158.71     683.19  -0.232    0.816    
bill_length_mm:speciesChinstrap   -35.38      17.75  -1.994    0.047 *  
bill_length_mm:speciesGentoo       14.96      15.79   0.948    0.344    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 371.8 on 336 degrees of freedom
Multiple R-squared:  0.7882,    Adjusted R-squared:  0.7851 
F-statistic: 250.1 on 5 and 336 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="step-3-interpret-interaction-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="step-3-interpret-interaction-coefficients">Step 3: Interpret interaction coefficients</h3>
<p>This is the trickiest part of regression. Let’s go slowly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    (Intercept)                  bill_length_mm 
                       34.88299                        94.49982 
               speciesChinstrap                   speciesGentoo 
                      811.26034                      -158.71092 
bill_length_mm:speciesChinstrap    bill_length_mm:speciesGentoo 
                      -35.38208                        14.95935 </code></pre>
</div>
</div>
<p><strong>How to read this:</strong></p>
<ol type="1">
<li><strong>Intercept</strong> and <strong>bill_length_mm</strong>: These apply to the <em>reference species</em> (Adelie, alphabetically first)</li>
<li><strong>speciesChinstrap</strong> and <strong>speciesGentoo</strong>: These are <em>adjustments</em> to the intercept for those species</li>
<li><strong>bill_length_mm:speciesChinstrap</strong> and <strong>bill_length_mm:speciesGentoo</strong>: These are <em>adjustments</em> to the slope for those species</li>
</ol>
<p><strong>Species-specific slopes:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>coef3 <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(model3)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate species-specific slopes</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>slope_adelie <span class="ot">&lt;-</span> coef3[<span class="st">"bill_length_mm"</span>]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>slope_chinstrap <span class="ot">&lt;-</span> coef3[<span class="st">"bill_length_mm"</span>] <span class="sc">+</span> coef3[<span class="st">"bill_length_mm:speciesChinstrap"</span>]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>slope_gentoo <span class="ot">&lt;-</span> coef3[<span class="st">"bill_length_mm"</span>] <span class="sc">+</span> coef3[<span class="st">"bill_length_mm:speciesGentoo"</span>]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display them</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Species =</span> <span class="fu">c</span>(<span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Slope =</span> <span class="fu">round</span>(<span class="fu">c</span>(slope_adelie, slope_chinstrap, slope_gentoo), <span class="dv">2</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Species</th>
<th style="text-align: right;">Slope</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: right;">94.50</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chinstrap</td>
<td style="text-align: right;">59.12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gentoo</td>
<td style="text-align: right;">109.46</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<ul>
<li>Adelie: 94.5 g/mm</li>
<li>Chinstrap: 59.12 g/mm<br>
</li>
<li>Gentoo: 109.46 g/mm</li>
</ul>
</section>
<section id="step-4-do-we-need-the-interaction" class="level3">
<h3 class="anchored" data-anchor-id="step-4-do-we-need-the-interaction">Step 4: Do we need the interaction?</h3>
<p>Test if the interaction terms improve the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model without interaction</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>model3_simple <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> species, <span class="at">data =</span> penguins)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>anova_comparison <span class="ot">&lt;-</span> <span class="fu">anova</span>(model3_simple, model3)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>anova_comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">338</td>
<td style="text-align: right;">47613707</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">336</td>
<td style="text-align: right;">46447006</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1166702</td>
<td style="text-align: right;">4.21999</td>
<td style="text-align: right;">0.0154854</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The p-value is 0.015. Since this is less than 0.05, the interaction <strong>is</strong> statistically significant. The slopes really do differ across species. We should keep the interaction in the model!</p>
<hr>
</section>
</section>
</section>
<section id="part-4-anova-is-just-regression" class="level1">
<h1>Part 4: ANOVA is Just Regression</h1>
<section id="the-big-reveal-anova-regression-with-categorical-predictors" class="level2">
<h2 class="anchored" data-anchor-id="the-big-reveal-anova-regression-with-categorical-predictors">The Big Reveal: ANOVA = Regression with categorical predictors</h2>
<p>This blows people’s minds every time. Let’s prove it.</p>
<section id="traditional-anova-approach" class="level3">
<h3 class="anchored" data-anchor-id="traditional-anova-approach">Traditional ANOVA approach</h3>
<p>Do the three species have different average body masses?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANOVA</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>aov_model <span class="ot">&lt;-</span> <span class="fu">aov</span>(body_mass_g <span class="sc">~</span> species, <span class="at">data =</span> penguins)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>aov_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(aov_model)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>aov_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Df    Sum Sq  Mean Sq F value Pr(&gt;F)    
species       2 146864214 73432107   343.6 &lt;2e-16 ***
Residuals   339  72443483   213698                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><strong>ANOVA says:</strong> F = 343.63, p &lt; 0.001. Species significantly affect body mass.</p>
</section>
<section id="regression-approach" class="level3">
<h3 class="anchored" data-anchor-id="regression-approach">Regression approach</h3>
<p>Now let’s use <code>lm()</code> with a categorical predictor:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression with species as predictor</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> species, <span class="at">data =</span> penguins)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>lm_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>lm_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ species, data = penguins)

Residuals:
     Min       1Q   Median       3Q      Max 
-1126.02  -333.09   -33.09   316.91  1223.98 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       3700.66      37.62   98.37   &lt;2e-16 ***
speciesChinstrap    32.43      67.51    0.48    0.631    
speciesGentoo     1375.35      56.15   24.50   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 462.3 on 339 degrees of freedom
Multiple R-squared:  0.6697,    Adjusted R-squared:  0.6677 
F-statistic: 343.6 on 2 and 339 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Notice the bottom line: <strong>F-statistic: 343.63, p &lt; 0.001</strong></p>
</section>
<section id="theyre-identical" class="level3">
<h3 class="anchored" data-anchor-id="theyre-identical">They’re identical!</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get ANOVA table from the lm model</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum Sq</th>
<th style="text-align: right;">Mean Sq</th>
<th style="text-align: right;">F value</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">species</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">146864214</td>
<td style="text-align: right;">73432107.1</td>
<td style="text-align: right;">343.6263</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">339</td>
<td style="text-align: right;">72443483</td>
<td style="text-align: right;">213697.6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Same F-statistic, same p-value, same conclusion.</strong> ANOVA is just regression where the predictor is categorical instead of continuous.</p>
</section>
<section id="what-do-the-regression-coefficients-mean" class="level3">
<h3 class="anchored" data-anchor-id="what-do-the-regression-coefficients-mean">What do the regression coefficients mean?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>coef_lm <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(lm_model)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>coef_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     (Intercept) speciesChinstrap    speciesGentoo 
      3700.66225         32.42598       1375.35401 </code></pre>
</div>
</div>
<ul>
<li><strong>Intercept (3700.66)</strong>: Mean body mass for Adelie (the reference group)</li>
<li><strong>speciesChinstrap (32.43)</strong>: Chinstrap penguins weigh 32.43g less than Adelie, on average</li>
<li><strong>speciesGentoo (1375.35)</strong>: Gentoo penguins weigh 1375.35g more than Adelie, on average</li>
</ul>
<p>Let’s verify this by calculating group means directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate means by species</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>species_means <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_mass =</span> <span class="fu">mean</span>(body_mass_g))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>species_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: right;">mean_mass</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: right;">3700.662</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chinstrap</td>
<td style="text-align: right;">3733.088</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gentoo</td>
<td style="text-align: right;">5076.016</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<ul>
<li>Adelie: 3700.66g (= intercept)</li>
<li>Chinstrap: 3733.09g = 3700.66 + 32.43 ✓</li>
<li>Gentoo: 5076.02g = 3700.66 + 1375.35 ✓</li>
</ul>
<p><strong>The regression coefficients directly tell us group differences!</strong></p>
<hr>
</section>
</section>
</section>
<section id="part-5-checking-your-model-diagnostics" class="level1">
<h1>Part 5: Checking Your Model (Diagnostics)</h1>
<section id="why-diagnostics-matter" class="level2">
<h2 class="anchored" data-anchor-id="why-diagnostics-matter">Why diagnostics matter</h2>
<p>Regression makes assumptions. If those assumptions are violated, your p-values and confidence intervals are unreliable. We need to check:</p>
<ol type="1">
<li><strong>Linearity</strong>: Is the relationship actually linear?</li>
<li><strong>Homoscedasticity</strong>: Is the variance constant?</li>
<li><strong>Normality</strong>: Are residuals roughly normal?</li>
<li><strong>Independence</strong>: Are observations independent? (Check by study design)</li>
</ol>
<section id="the-four-diagnostic-plots" class="level3">
<h3 class="anchored" data-anchor-id="the-four-diagnostic-plots">The four diagnostic plots</h3>
<p>R gives us four helpful plots. Let’s use model2 (body mass ~ bill length + flipper length):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create all four diagnostic plots</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))  <span class="co"># 2x2 grid of plots</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_tutorial_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))  <span class="co"># reset to single plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-read-each-plot" class="level3">
<h3 class="anchored" data-anchor-id="how-to-read-each-plot">How to read each plot</h3>
<p><strong>Plot 1: Residuals vs Fitted</strong></p>
<ul>
<li><strong>What to look for</strong>: Random scatter around the horizontal line at zero</li>
<li><strong>Red flag</strong>: A pattern (curve, U-shape) means the relationship isn’t linear</li>
<li><strong>Red flag</strong>: A funnel shape (wider on one side) means variance isn’t constant</li>
</ul>
<p><strong>Plot 2: Normal Q-Q</strong></p>
<ul>
<li><strong>What to look for</strong>: Points following the diagonal line</li>
<li><strong>Red flag</strong>: Points curving away from the line means residuals aren’t normal</li>
<li><strong>Note</strong>: Small deviations at the ends are usually okay</li>
</ul>
<p><strong>Plot 3: Scale-Location</strong></p>
<ul>
<li><strong>What to look for</strong>: Random scatter, roughly flat red line</li>
<li><strong>Red flag</strong>: Red line sloping up means variance increases with fitted values</li>
<li><strong>This checks</strong>: Homoscedasticity (constant variance)</li>
</ul>
<p><strong>Plot 4: Residuals vs Leverage</strong></p>
<ul>
<li><strong>What to look for</strong>: All points inside the dashed lines (Cook’s distance)</li>
<li><strong>Red flag</strong>: Points outside the dashed lines have high influence</li>
<li><strong>What it means</strong>: These observations strongly affect the regression line</li>
</ul>
</section>
<section id="what-does-model2-look-like" class="level3">
<h3 class="anchored" data-anchor-id="what-does-model2-look-like">What does model2 look like?</h3>
<p>Looking at our four plots:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked=""><strong>Residuals vs Fitted</strong>: Pretty random, no strong pattern</label></li>
<li><label><input type="checkbox" checked=""><strong>Q-Q plot</strong>: Points mostly follow the line; residuals are roughly normal</label></li>
<li><label><input type="checkbox" checked=""><strong>Scale-Location</strong>: Fairly flat; variance looks constant</label></li>
<li><label><input type="checkbox" checked=""><strong>Residuals vs Leverage</strong>: No points way outside; no highly influential observations</label></li>
</ul>
<p><strong>Verdict:</strong> This model looks good! Assumptions are reasonably met.</p>
</section>
<section id="when-things-go-wrong-an-example" class="level3">
<h3 class="anchored" data-anchor-id="when-things-go-wrong-an-example">When things go wrong: An example</h3>
<p>Let’s see what bad diagnostics look like. We’ll fit a model that doesn’t account for species:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deliberately ignoring species</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>bad_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm, <span class="at">data =</span> penguins)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bad_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_tutorial_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What’s wrong here?</strong></p>
<ul>
<li><strong>Residuals vs Fitted</strong>: You can see some pattern/grouping—we’re missing an important predictor (species)</li>
<li><strong>Q-Q plot</strong>: Tails deviate more from the line</li>
<li>This shows why model2 (which includes flipper length) is better</li>
</ul>
<hr>
</section>
</section>
</section>
<section id="summary-the-essential-r-commands" class="level1">
<h1>Summary: The Essential R Commands</h1>
<p>Here’s everything you need to know:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a model</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> mydata)                    <span class="co"># simple regression</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> mydata)              <span class="co"># multiple regression</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">*</span> x2, <span class="at">data =</span> mydata)              <span class="co"># with interaction</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at results</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)                <span class="co"># full output</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model)           <span class="co"># just the coefficients</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(model)               <span class="co"># confidence intervals</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model)                 <span class="co"># ANOVA table</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract components</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>coefficients           <span class="co"># coefficients</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(model)               <span class="co"># predicted values</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(model)            <span class="co"># residuals</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>r.squared    <span class="co"># R-squared</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare models</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)       <span class="co"># test if model2 is better</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostics</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)                 <span class="co"># creates 4 diagnostic plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="practice-exercises" class="level1">
<h1>Practice Exercises</h1>
<p><strong>Try these yourself:</strong></p>
<ol type="1">
<li><p>Fit a simple regression predicting <code>body_mass_g</code> from <code>flipper_length_mm</code>. What’s the slope? Interpret it in plain English.</p></li>
<li><p>Add <code>bill_length_mm</code> to create a multiple regression. How did the flipper length coefficient change?</p></li>
<li><p>Fit separate regressions for each species (use <code>filter()</code>). Do Adelie, Chinstrap, and Gentoo have different slopes?</p></li>
<li><p>Use <code>lm()</code> to test if body mass differs between male and female penguins. Then verify your answer using <code>t.test()</code>.</p></li>
<li><p>Check the diagnostics for your models. Do any assumptions look violated?</p></li>
</ol>
<hr>
</section>
<section id="what-youve-learned" class="level1">
<h1>What You’ve Learned</h1>
<ul>
<li>How to fit linear models with <code>lm()</code></li>
<li>How to extract and interpret coefficients</li>
<li>The difference between simple and multiple regression</li>
<li>What interactions mean and how to test them</li>
<li>That ANOVA is secretly just regression</li>
<li>How to check if your model assumptions are met</li>
</ul>
<p><strong>Most importantly:</strong> You learned to interrogate model objects directly using base R, not relying on fancy packages. This is how you really understand what’s going on under the hood.</p>
<p>Now go practice with your own data!</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>